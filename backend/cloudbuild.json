{
  "steps": [
    {
      "name": "gcr.io/kaniko-project/executor:latest",
      "id": "agent",
      "args": [
        "--dockerfile=backend/Dockerfile",
        "--context=/backend",
        "--destination=gcr.io/prouml/agent:$SHORT_SHA",
        "--build-arg=SHORT_SHA=$SHORT_SHA",
        "--cache=true",
        "--cache-ttl=5h"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "id": "agent-retag",
      "waitFor": ["agent"],
      "args": ["--quiet", "container", "images", "add-tag", "gcr.io/prouml/ct-agent:$SHORT_SHA", "gcr.io/prouml/ct-agent:latest"]
    }
  ]
}
